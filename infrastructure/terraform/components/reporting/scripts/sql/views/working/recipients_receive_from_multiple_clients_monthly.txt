SELECT
    createdMonth,
    numberOfClients,
    COUNT(*) AS countOfRecipients
FROM (
    SELECT
        createdMonth,
        nhsnumberhash,
        COUNT(DISTINCT clientid) AS numberOfClients
    FROM vw_monthly_delivered_messages
    WHERE communicationType = 'NHSAPP'
    GROUP BY 1, 2
    HAVING COUNT(DISTINCT clientid) > 1
)
GROUP BY 1, 2
