SELECT
    createdMonth,
    monthlyTotalMessages,
    COUNT(*) AS countOfRecipients
FROM (
    SELECT
        createdMonth,
        nhsnumberhash,
        COUNT(*) AS monthlyTotalMessages
    FROM vw_monthly_delivered_messages
    GROUP BY 1, 2
)
GROUP BY 1, 2
