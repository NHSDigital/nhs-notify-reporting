SELECT
    createdMonth,
    AppMessages,
    COUNT(*) AS countOfRecipients
FROM (
    SELECT
        createdMonth,
        nhsnumberhash,
        COUNT(*) AS AppMessages
    FROM vw_monthly_delivered_messages
    WHERE communicationType = 'NHSAPP'
    GROUP BY 1, 2
)
GROUP BY 1, 2
